{
  "hash": "88bb0868490197f96e99ce758c2cb9b8",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Module 3: Estimating Biomass From Tree Ring Data\"\nauthor: \"Andria Dawson and Kelly Heilman\"\nformat:\n  html:\n    code-fold: true\n---\n\n\n\n\n# Biomass estimation from tree ring and forest census data\n\nHow do we get estimates of aboveground biomass and forest carbon from tree diameters and tree ring data?\n\nAllometric equations define the relationship between commonly measured aspects of a tree (usually tree species, diameter, and/or height) and the weight of the tree (aboveground biomass, AGB). These equations are developed through a small set of destructive samples-- this involves sampling tree size, height, and species, measuring tree mass, and developing a quantitative relationship between the commonly measured metric and tree mass.\n\nIn this module we will:\n\n1.  Apply species-specific allometric equations to the Harvard Forest Census dataset to estimate AGB at the time of census\n\n2.  Back-calculate tree diameter from the tree ring data at Harvard Forest\n\n3.  Apply allometric equations to the back-calculated tree diameters at Harvard Forest to estimate a timeseries of AGB.\n\n## 1. Estimating Forest biomass for trees at the time of census\n\n### We will use the allometric equations in the `allodb` R package\n\nThis package is available on github, and we highlight some additional resources here:\n\n-   Citation: Gonzalez-Akre, E.,  Piponiot, C.,  Lepore, M.,  Herrmann, V.,  Lutz, J. A.,  Baltzer, J. L.,  Dick, C. W.,  Gilbert, G. S., He, F.,  Heym, M.,  Huerta, A. I.,  Jansen, P. A.,  Johnson, D. J.,  Knapp, N.,  Král, K.,  Lin, D.,  Malhi, Y.,  McMahon, S. M.,  Myers, J. A., ...  Anderson-Teixeira, K. J. (2022).  [*allodb*: An R package for biomass estimation at globally distributed extratropical forest plots.](https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/2041-210X.13756) *Methods in Ecology and Evolution*,  13,  330--338. <https://doi.org/10.1111/2041-210X.13756>\n\n-   Github repository: <https://github.com/ropensci/allodb/tree/master>\n\n-   Tutorial at Ropensci: <https://docs.ropensci.org/allodb/>\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\nLet's explore allodb's allometric objects and functions.\n\nObjects include:\n\n-   `equations`: an object that has the original allometric reference/citation, location of the data, the type of equation, information on units, and alot of additional information\n\n-   `references`: an object that has citations, authors, etc, for the original reference data\n\n-   `sitespecies`: an object that lists the sites, species, genus, family, and species_code information for some of the example data available with the allodb package\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"ref_id\"                       \"equation_id\"                 \n [3] \"equation_allometry\"           \"equation_form\"               \n [5] \"dependent_variable\"           \"independent_variable\"        \n [7] \"equation_taxa\"                \"allometry_specificity\"       \n [9] \"equation_categ\"               \"geographic_area\"             \n[11] \"original_coord\"               \"lat\"                         \n[13] \"long\"                         \"elev_m\"                      \n[15] \"geography_notes\"              \"mat_C\"                       \n[17] \"min.temp_C\"                   \"max.temp_C\"                  \n[19] \"map_mm\"                       \"frost_free_period_days\"      \n[21] \"climate_notes\"                \"stand_age_range_yr\"          \n[23] \"stand_age_history\"            \"stand_basal_area_m2_ha\"      \n[25] \"stand_trees_ha\"               \"forest_description\"          \n[27] \"ecosystem_type\"               \"koppen\"                      \n[29] \"dbh_min_cm\"                   \"dbh_max_cm\"                  \n[31] \"sample_size\"                  \"collection_year\"             \n[33] \"dbh_units_original\"           \"dbh_unit_CF\"                 \n[35] \"output_units_original\"        \"output_units_CF\"             \n[37] \"allometry_development_method\" \"regression_model\"            \n[39] \"r_squared\"                    \"other_equations_tested\"      \n[41] \"log_biomass\"                  \"bias_corrected\"              \n[43] \"bias_correction_factor\"       \"notes_fitting_model\"         \n[45] \"original_equation_id\"         \"original_data_availability\"  \n[47] \"equation_notes\"              \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"site\"         \"family\"       \"genus\"        \"species\"      \"variety\"     \n [6] \"subspecies\"   \"latin_name\"   \"species_code\" \"life_form\"    \"notes\"       \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"ref_id\"                   \"ref_doi\"                 \n[3] \"ref_author\"               \"ref_year\"                \n[5] \"ref_title\"                \"References full citation\"\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Picea mariana\" \"Picea glauca\"  \"Betula\"        \"Fagus\"        \n[5] \"Fraxinus\"      \"Picea\"        \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"exp(a+b*log(dbh))\"                         \n[2] \"exp(a+b*(log(dbh))\"                        \n[3] \"exp((a*(dbh-c))*(2*b+(dbh-c))/(b+(dbh-c)))\"\n[4] \"dbh((1/a)+(dbh/b))\"                        \n[5] \"10^(a+b*(log10(dbh)))\"                     \n[6] \"exp(a+b*log(dba))\"                         \n```\n\n\n:::\n:::\n\n\n\n\nHere, we will focus on species from Harvard Forest, so lets see which species we have in our census data. This information is stored in the `taxon` column in the `Census` object:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# lets visualize the number of trees sampled at Harvard Forest each census year:\nCensus %>% group_by(taxon, `Scientific Name`, COMMON_NAME, INV.YEAR) %>%\n  summarise(n.trees = n()) %>% \n  group_by(taxon, `Scientific Name`, COMMON_NAME) %>% \n  spread(INV.YEAR, n.trees, fill = 0) %>%\n  ungroup() %>% gt()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"foaugveucw\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#foaugveucw table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#foaugveucw thead, #foaugveucw tbody, #foaugveucw tfoot, #foaugveucw tr, #foaugveucw td, #foaugveucw th {\n  border-style: none;\n}\n\n#foaugveucw p {\n  margin: 0;\n  padding: 0;\n}\n\n#foaugveucw .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#foaugveucw .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#foaugveucw .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#foaugveucw .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#foaugveucw .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#foaugveucw .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#foaugveucw .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#foaugveucw .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#foaugveucw .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#foaugveucw .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#foaugveucw .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#foaugveucw .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#foaugveucw .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#foaugveucw .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#foaugveucw .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#foaugveucw .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#foaugveucw .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#foaugveucw .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#foaugveucw .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#foaugveucw .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#foaugveucw .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#foaugveucw .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#foaugveucw .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#foaugveucw .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#foaugveucw .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#foaugveucw .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#foaugveucw .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#foaugveucw .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#foaugveucw .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#foaugveucw .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#foaugveucw .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#foaugveucw .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#foaugveucw .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#foaugveucw .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#foaugveucw .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#foaugveucw .gt_left {\n  text-align: left;\n}\n\n#foaugveucw .gt_center {\n  text-align: center;\n}\n\n#foaugveucw .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#foaugveucw .gt_font_normal {\n  font-weight: normal;\n}\n\n#foaugveucw .gt_font_bold {\n  font-weight: bold;\n}\n\n#foaugveucw .gt_font_italic {\n  font-style: italic;\n}\n\n#foaugveucw .gt_super {\n  font-size: 65%;\n}\n\n#foaugveucw .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#foaugveucw .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#foaugveucw .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#foaugveucw .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#foaugveucw .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#foaugveucw .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#foaugveucw .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"taxon\">taxon</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Scientific Name\">Scientific Name</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"COMMON_NAME\">COMMON_NAME</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"1960\">1960</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"1967\">1967</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"1973\">1973</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"1990\">1990</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"1999\">1999</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"2009\">2009</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"taxon\" class=\"gt_row gt_left\">ACRU</td>\n<td headers=\"Scientific Name\" class=\"gt_row gt_left\">Acer rubrum</td>\n<td headers=\"COMMON_NAME\" class=\"gt_row gt_left\">red maple</td>\n<td headers=\"1960\" class=\"gt_row gt_right\">41</td>\n<td headers=\"1967\" class=\"gt_row gt_right\">211</td>\n<td headers=\"1973\" class=\"gt_row gt_right\">188</td>\n<td headers=\"1990\" class=\"gt_row gt_right\">141</td>\n<td headers=\"1999\" class=\"gt_row gt_right\">111</td>\n<td headers=\"2009\" class=\"gt_row gt_right\">90</td></tr>\n    <tr><td headers=\"taxon\" class=\"gt_row gt_left\">BEAL</td>\n<td headers=\"Scientific Name\" class=\"gt_row gt_left\">Betula alleghaniensis</td>\n<td headers=\"COMMON_NAME\" class=\"gt_row gt_left\">yellow birch</td>\n<td headers=\"1960\" class=\"gt_row gt_right\">8</td>\n<td headers=\"1967\" class=\"gt_row gt_right\">17</td>\n<td headers=\"1973\" class=\"gt_row gt_right\">18</td>\n<td headers=\"1990\" class=\"gt_row gt_right\">16</td>\n<td headers=\"1999\" class=\"gt_row gt_right\">24</td>\n<td headers=\"2009\" class=\"gt_row gt_right\">29</td></tr>\n    <tr><td headers=\"taxon\" class=\"gt_row gt_left\">BELE</td>\n<td headers=\"Scientific Name\" class=\"gt_row gt_left\">Betula lenta</td>\n<td headers=\"COMMON_NAME\" class=\"gt_row gt_left\">sweet birch</td>\n<td headers=\"1960\" class=\"gt_row gt_right\">2</td>\n<td headers=\"1967\" class=\"gt_row gt_right\">5</td>\n<td headers=\"1973\" class=\"gt_row gt_right\">5</td>\n<td headers=\"1990\" class=\"gt_row gt_right\">7</td>\n<td headers=\"1999\" class=\"gt_row gt_right\">10</td>\n<td headers=\"2009\" class=\"gt_row gt_right\">16</td></tr>\n    <tr><td headers=\"taxon\" class=\"gt_row gt_left\">FAGR</td>\n<td headers=\"Scientific Name\" class=\"gt_row gt_left\">Fagus grandifolia</td>\n<td headers=\"COMMON_NAME\" class=\"gt_row gt_left\">American beech</td>\n<td headers=\"1960\" class=\"gt_row gt_right\">2</td>\n<td headers=\"1967\" class=\"gt_row gt_right\">4</td>\n<td headers=\"1973\" class=\"gt_row gt_right\">4</td>\n<td headers=\"1990\" class=\"gt_row gt_right\">12</td>\n<td headers=\"1999\" class=\"gt_row gt_right\">16</td>\n<td headers=\"2009\" class=\"gt_row gt_right\">26</td></tr>\n    <tr><td headers=\"taxon\" class=\"gt_row gt_left\">HAVI</td>\n<td headers=\"Scientific Name\" class=\"gt_row gt_left\">Hamamelis virginiana</td>\n<td headers=\"COMMON_NAME\" class=\"gt_row gt_left\">American witchhazel</td>\n<td headers=\"1960\" class=\"gt_row gt_right\">2</td>\n<td headers=\"1967\" class=\"gt_row gt_right\">5</td>\n<td headers=\"1973\" class=\"gt_row gt_right\">5</td>\n<td headers=\"1990\" class=\"gt_row gt_right\">9</td>\n<td headers=\"1999\" class=\"gt_row gt_right\">10</td>\n<td headers=\"2009\" class=\"gt_row gt_right\">25</td></tr>\n    <tr><td headers=\"taxon\" class=\"gt_row gt_left\">PIST</td>\n<td headers=\"Scientific Name\" class=\"gt_row gt_left\">Pinus strobus</td>\n<td headers=\"COMMON_NAME\" class=\"gt_row gt_left\">eastern white pine</td>\n<td headers=\"1960\" class=\"gt_row gt_right\">4</td>\n<td headers=\"1967\" class=\"gt_row gt_right\">29</td>\n<td headers=\"1973\" class=\"gt_row gt_right\">24</td>\n<td headers=\"1990\" class=\"gt_row gt_right\">6</td>\n<td headers=\"1999\" class=\"gt_row gt_right\">8</td>\n<td headers=\"2009\" class=\"gt_row gt_right\">8</td></tr>\n    <tr><td headers=\"taxon\" class=\"gt_row gt_left\">QURU</td>\n<td headers=\"Scientific Name\" class=\"gt_row gt_left\">Quercus rubra</td>\n<td headers=\"COMMON_NAME\" class=\"gt_row gt_left\">northern red oak</td>\n<td headers=\"1960\" class=\"gt_row gt_right\">27</td>\n<td headers=\"1967\" class=\"gt_row gt_right\">129</td>\n<td headers=\"1973\" class=\"gt_row gt_right\">114</td>\n<td headers=\"1990\" class=\"gt_row gt_right\">79</td>\n<td headers=\"1999\" class=\"gt_row gt_right\">73</td>\n<td headers=\"2009\" class=\"gt_row gt_right\">67</td></tr>\n    <tr><td headers=\"taxon\" class=\"gt_row gt_left\">QUVE</td>\n<td headers=\"Scientific Name\" class=\"gt_row gt_left\">Quercus velutina</td>\n<td headers=\"COMMON_NAME\" class=\"gt_row gt_left\">black oak</td>\n<td headers=\"1960\" class=\"gt_row gt_right\">1</td>\n<td headers=\"1967\" class=\"gt_row gt_right\">7</td>\n<td headers=\"1973\" class=\"gt_row gt_right\">6</td>\n<td headers=\"1990\" class=\"gt_row gt_right\">4</td>\n<td headers=\"1999\" class=\"gt_row gt_right\">3</td>\n<td headers=\"2009\" class=\"gt_row gt_right\">3</td></tr>\n    <tr><td headers=\"taxon\" class=\"gt_row gt_left\">TSCA</td>\n<td headers=\"Scientific Name\" class=\"gt_row gt_left\">Tsuga canadensis</td>\n<td headers=\"COMMON_NAME\" class=\"gt_row gt_left\">eastern hemlock</td>\n<td headers=\"1960\" class=\"gt_row gt_right\">3</td>\n<td headers=\"1967\" class=\"gt_row gt_right\">4</td>\n<td headers=\"1973\" class=\"gt_row gt_right\">7</td>\n<td headers=\"1990\" class=\"gt_row gt_right\">8</td>\n<td headers=\"1999\" class=\"gt_row gt_right\">13</td>\n<td headers=\"2009\" class=\"gt_row gt_right\">25</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n\n```{.r .cell-code}\n# we can also plot this up visually:\n\nggplot(data = Census)+\ngeom_bar(aes(x = as.character(INV.YEAR), fill = `Scientific Name`), position = \"dodge\")+theme_bw()+\nylab(\"Number of Trees Observed\")+\nxlab(\"Inventory Year\")+facet_wrap(~site, ncol = 1)\n```\n\n::: {.cell-output-display}\n![](Module_3_Biomass_estimation_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n\nBased on this table and figure, which species do you think will have the largest aboveground biomass?\n\n### Lets use the `get_biomass` function from allodb to get estimates of biomass\n\nThis function requires the following arguments and provides and output of Aboveground biomass in kilograms (kg):\n\n-   `dbh`: diameter at breast height (cm), numeric\n\n-   `genus`: genus of the tree, character\n\n-   `species`: the species name of the tree, character, can be NULL if only genus is known\n\n-   `coords`: a vector (longitude, latitude) of the plot location, or a matrix with 2 columns if trees have individual locations\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(allodb)\n\n# lets get the biomass for the first tree in the Census data (a 36.83 cm Northern Red Oak (Quercus rubra):\n\nCensus.1 <- Census[1,] # first tree\n\nCensus.1$AGB.1 <-\n  get_biomass(\n    dbh = Census.1$dbh ,\n    genus = Census.1$GENUS,\n    species = Census.1$SPECIES,\n    coords = c(Census.1$lon, Census.1$lat)\n  )\n\nCensus.1$AGB\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 979.5547\n```\n\n\n:::\n:::\n\n\n\n\nNow lets apply this function to the whole dataset\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nll <- matrix(c(Census$lon, Census$lat), nrow = length(Census$lon), ncol = 2, byrow = FALSE, dimnames = NULL)\n\n# here we split up the census by sites \nCensus.LF1 <- Census %>% filter(site %in% \"LF1\")\nLF1.ll <- HARV.ll %>% filter(site %in% \"LF1\")\n\nCensus.LF2 <- Census %>% filter(site %in% \"LF2\")\nLF2.ll <- HARV.ll %>% filter(site %in% \"LF2\")\n\nCensus.LF3 <- Census %>% filter(site %in% \"LF3\")\nLF3.ll <- HARV.ll %>% filter(site %in% \"LF3\")\n\n# get the biomass for each site:\nCensus.LF1$AGB_kg <-\n  get_biomass(\n    dbh = Census.LF1$dbh ,\n    genus = Census.LF1$GENUS,\n    species = Census.LF1$SPECIES,\n    coords = c(LF1.ll$lon, LF1.ll$lat))\n\n\nCensus.LF2$AGB_kg <-\n  get_biomass(\n    dbh = Census.LF2$dbh ,\n    genus = Census.LF2$GENUS,\n    species = Census.LF2$SPECIES,\n    coords = c(LF2.ll$lon, LF2.ll$lat))\n\nCensus.LF3$AGB_kg <-\n  get_biomass(\n    dbh = Census.LF3$dbh ,\n    genus = Census.LF3$GENUS,\n    species = Census.LF3$SPECIES,\n    coords = c(LF3.ll$lon, LF3.ll$lat))\n\nCensus.AGB <- rbind(Census.LF1, Census.LF2, Census.LF3)\n\n\nggplot(data = Census.AGB)+\n  geom_point(aes(x = INV.YEAR, y = AGB_kg, group = ID, color = `Scientific Name`))+\n  geom_line(aes(x = INV.YEAR, y = AGB_kg, group = ID, color = `Scientific Name`))+\n  facet_wrap(~site)+theme_bw()+ylab(\"Tree Aboveground Biomass (kg)\")+xlab(\"Year\")\n```\n\n::: {.cell-output-display}\n![](Module_3_Biomass_estimation_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n\n### Lets get the total species trajectories of biomass over the census periods:\n\nWhich species are increasing the most over time? Is this what you expected based on the number of trees tallied? Here, we have added lines to visualize the trajectory of taxon AGB over time, but we don't have estimates of variability in annual AGB increment over time.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nCensus.AGB.sums <- Census.AGB %>% group_by(taxon, `Scientific Name`, site, INV.YEAR) %>% \n  summarise(`Aboveground Biomass` = sum(AGB_kg, na.rm =TRUE))\n\nggplot(data = Census.AGB.sums)+\n  geom_point(aes(x = INV.YEAR, y = `Aboveground Biomass`, color = `Scientific Name`))+\n  geom_line(aes(x = INV.YEAR, y = `Aboveground Biomass`, color = `Scientific Name`))+\n  facet_wrap(~site)+theme_bw()+ylab(\"Taxon Aboveground Biomass (kg)\")+xlab(\"Year\")\n```\n\n::: {.cell-output-display}\n![](Module_3_Biomass_estimation_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n\n### What affects the trajectory of AGB over time?\n\nForest demographic processes affecting AGB:\n\n-   ***Recruitment*** of new small trees into the plot\n-   ***Mortality*** of trees (or conversely, survival)\n-   ***Growth*** of existing trees in the plot\n\nCensus data provide an estimate of these processes over the remeasurement period.\n\nRecruitment makes up a small amount of AGB at these plots:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Recruitment\nrecruit.code.census <- Census.AGB %>% select(site, ID, taxon, AGB_kg, INV.YEAR) %>% \n  group_by(site, ID, taxon) %>%\n  spread( INV.YEAR, AGB_kg, fill = NA) %>%\n  reshape2::melt(., id.vars = c(\"site\", \"ID\", \"taxon\")) %>%\n  arrange(ID, variable) %>% \n  \n  # if there was no measurement in the previous year for the tree, give a recruit code of 1\n  mutate(recruit.code = ifelse(is.na(lag(value)), 1, 0)) %>%\n  \n  # if the current value is NA for the tree, set it to 0\n  mutate(recruit.code = ifelse(is.na(value), 0, recruit.code)) %>% \n  # set all recruit.code in the initial census to 0\n  mutate(recruit.code = ifelse(site %in% \"LF1\" & variable == 1960, 0, \n                               ifelse(site %in% c(\"LF2\", \"LF3\") & variable == 1967, 0, recruit.code))) %>% \n  mutate(Recruitment = ifelse(recruit.code == 1, \"New Recruit\", \"Existing Tree\"))\n\n\nrecruit.code.census %>% filter(ID %in% \"LF1001\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  site     ID taxon variable    value recruit.code   Recruitment\n1  LF1 LF1001  TSCA     1960       NA            0 Existing Tree\n2  LF1 LF1001  TSCA     1967       NA            0 Existing Tree\n3  LF1 LF1001  TSCA     1973       NA            0 Existing Tree\n4  LF1 LF1001  TSCA     1990 19.36831            1   New Recruit\n5  LF1 LF1001  TSCA     1999 45.02890            0 Existing Tree\n6  LF1 LF1001  TSCA     2009 99.23069            0 Existing Tree\n```\n\n\n:::\n\n```{.r .cell-code}\nggplot(data = recruit.code.census) + \n  geom_col(aes(x = variable, y = value, fill = Recruitment), stat = \"identity\")+facet_wrap(~site)+ylab(\"Aboveground Biomass (kg)\")\n```\n\n::: {.cell-output-display}\n![](Module_3_Biomass_estimation_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\nThere are some mortality events that remove AGB \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Mortality\nmortality.code.census <- Census.AGB %>% #select(site, ID, taxon, AGB_kg, INV.YEAR) %>% \n  group_by(site, ID) %>%\n  mutate(max.INVYR = max(INV.YEAR, na.rm =TRUE))%>%\n  ungroup()%>%\n  mutate(mort.code = ifelse(INV.YEAR == max.INVYR & finalCond %in% \"dead\", 1, 0)) %>%\n  mutate(Mortality = ifelse(mort.code == 1, \"Dead\", \"Live\"))\n\n\n\n\nggplot(data = mortality.code.census) + \n  geom_col(aes(x = INV.YEAR, y = AGB_kg, fill = Mortality), stat = \"identity\")+facet_wrap(~site)+ylab(\"Aboveground Biomass (kg)\")\n```\n\n::: {.cell-output-display}\n![](Module_3_Biomass_estimation_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\nTree and taxon average annual growth and average annual aboveground biomass increment (AGBI) appear to vary across remeasurement periods:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Growth\nAverage.Growth.census <- mortality.code.census %>% \n  group_by(site, ID) %>%\n  arrange(cal.year) %>% \n  mutate(REMPER = cal.year - lag(cal.year),\n         prevDBH = lag(dbh), \n         prevAGB = lag(AGB_kg)) %>% \n  # if the tree died in the remeasurement period, assume it died halfway through \n  mutate(REMPER.mort.corrected = ifelse(mort.code == 1, REMPER/2, REMPER)) %>%\n  ungroup() %>%\n  mutate(tree.AGBI = (AGB_kg - prevAGB)/REMPER.mort.corrected, \n         tree.growth = (dbh - prevDBH)/REMPER.mort.corrected) \n\n\nggplot(data = Average.Growth.census) + \n  geom_point(aes(x = INV.YEAR, y = tree.AGBI, color = taxon, group = ID))+\n  geom_line(aes(x = INV.YEAR, y = tree.AGBI, color = taxon, group = ID))+ facet_wrap(~site)+ylab(\"Tree Average Aboveground Biomass Increment (kg/year)\")\n```\n\n::: {.cell-output-display}\n![](Module_3_Biomass_estimation_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(data = Average.Growth.census) + \n  geom_point(aes(x = INV.YEAR, y = tree.growth, color = taxon, group = ID))+\n  geom_line(aes(x = INV.YEAR, y = tree.growth, color = taxon, group = ID))+ facet_wrap(~site)+ylab(\"Tree Average Growth Increment (cm/year)\")+xlab(\"Inventory Year\")\n```\n\n::: {.cell-output-display}\n![](Module_3_Biomass_estimation_files/figure-html/unnamed-chunk-9-2.png){width=672}\n:::\n\n```{.r .cell-code}\nsite.avgs <- Average.Growth.census %>% group_by(site, taxon, INV.YEAR)%>%\n  summarise(taxon.AGBI.avg = mean(tree.AGBI, na.rm =TRUE), \n            taxon.DI.avg = mean(tree.AGBI, na.rm =TRUE))\nggplot(data = site.avgs) + \n  geom_point(aes(x = INV.YEAR, y = taxon.DI.avg, color = taxon))+\n  geom_line(aes(x = INV.YEAR, y = taxon.DI.avg, color = taxon))+ facet_wrap(~site)+ylab(\"Taxon Average Growth Increment (cm/year)\")+xlab(\"Inventory Year\")\n```\n\n::: {.cell-output-display}\n![](Module_3_Biomass_estimation_files/figure-html/unnamed-chunk-9-3.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(data = site.avgs) + \n  geom_point(aes(x = INV.YEAR, y = taxon.AGBI.avg, color = taxon))+\n  geom_line(aes(x = INV.YEAR, y = taxon.AGBI.avg, color = taxon))+ facet_wrap(~site)+ylab(\"Taxon Average AGBI (kg/year)\")+xlab(\"Inventory Year\")\n```\n\n::: {.cell-output-display}\n![](Module_3_Biomass_estimation_files/figure-html/unnamed-chunk-9-4.png){width=672}\n:::\n:::\n\n\n\nHowever, some remeasurement periods are quite long, and we miss inter-annual variation that could lead to differences in estimates of annual AGBI. Tree-ring data can help us fill in these gaps in our understanding of how AGB varies over time, since they are a direct measurement of annual growth. \n\n## Step 2: Use tree ring data to back-calculate tree diameter at Harvard Forest:\nIn order to use tree ring data to estimate tree AGB, we first need to convert measurements of annual tree growth into estimates of tree diameter. To do this with a single core, we assume that each tree grows symmetrically and in a circle. \n\n### Backcalculating tree diameter using dplR\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplR)\n```\n:::\n\n\n\n\n### Step 3: visualizing biomass over time (with no uncertainty)\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n## Converting forest biomass to carbon using carbon fractions\n\nThe simplest way of estimating Carbon from tree-level biomass is to assume that the \"carbon fraction,\" that is the fraction of the tree's weight that is made up of Carbon, is 50%, so multiplying your biomass value by 0.5 will give you a mass of Carbon per unit area.\n\nOther carbon fractions are available, for example for live trees vs. dead trees, and for different forest types/species, but for simplicity we will use 0.5 here.\n\n# issues with estimating biomass this way:\n",
    "supporting": [
      "Module_3_Biomass_estimation_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}